<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤íŒŒë¥´íƒ€ ì•”ê¸°ì¥ (ìµœì¢…)</title>
    <style>
        /* ë³€ìˆ˜ ì„¤ì • */
        :root { --primary: #4f46e5; --bg: #f8fafc; --card: #ffffff; --text: #334155; --success: #22c55e; --error: #ef4444; }
        
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { width: 100%; max-width: 600px; background: var(--card); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        h1, h2 { text-align: center; color: #1e293b; margin-bottom: 10px; }
        
        /* Inputs & Buttons */
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .btn { display: block; width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); margin-top: 5px; }
        
        /* Bulk Paste */
        textarea { height: 100px; font-family: monospace; resize: vertical; margin-bottom: 10px; }

        /* Quiz UI */
        .quiz-status { display: flex; justify-content: space-between; color: #64748b; font-size: 0.9rem; margin-bottom: 20px; }
        .question-box { font-size: 1.4rem; font-weight: bold; text-align: center; margin: 30px 0; word-break: keep-all; }
        
        /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ í•µì‹¬ ìˆ˜ì • ë¶€ë¶„ 1: í”¼ë“œë°± ë°•ìŠ¤ ê¸°ë³¸ display:none ì†ì„± ì œê±° ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
        .feedback-area { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center; 
            min-height: 50px; /* ê³µê°„ í™•ë³´ */
        }
        /* ğŸ‘†ğŸ‘†ğŸ‘† */
        
        .feedback-area.correct { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .feedback-area.wrong { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .correct-answer-display { font-weight: bold; font-size: 1.1rem; margin-top: 5px; }

        /* Helpers */
        /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ í•µì‹¬ ìˆ˜ì • ë¶€ë¶„ 2: hidden í´ë˜ìŠ¤ë¥¼ ê°€ì¥ ê°•ë ¥í•˜ê²Œ ì •ì˜ ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
        .hidden { display: none !important; }
        /* ğŸ‘†ğŸ‘†ğŸ‘† */
        
        #question-list { list-style: none; padding: 0; max-height: 200px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px; }
        #question-list li { padding: 8px 12px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; font-size: 0.9rem; }
        .badge { background: #e2e8f0; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="editor-view">
        <h1>ğŸ“ ë¬¸ì œ ë§Œë“¤ê¸°</h1>
        
        <div class="input-group">
            <input type="text" id="input-q" placeholder="ë¬¸ì œ (ì˜ˆ: ì‚¬ê³¼)" onkeypress="handleEnter(event, 'add')">
            <input type="text" id="input-a" placeholder="ì •ë‹µ (ì˜ˆ: apple)" onkeypress="handleEnter(event, 'add')">
        </div>
        <button class="btn btn-outline" style="margin-top:0; margin-bottom:15px;" onclick="addQuestion()">â¬‡ï¸ í•˜ë‚˜ ì¶”ê°€í•˜ê¸°</button>

        <details>
            <summary style="cursor:pointer; color:#64748b; margin-bottom:10px;">ì—‘ì…€/í‘œ ë¶™ì—¬ë„£ê¸° (í´ë¦­)</summary>
            <textarea id="bulk-data" placeholder="ë¬¸ì œ [íƒ­] ì •ë‹µ í˜•ì‹ìœ¼ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
            <button class="btn" style="background:#10b981;" onclick="loadFromPaste()">ğŸ“‹ í‘œ ë°ì´í„° ì¶”ê°€í•˜ê¸°</button>
        </details>

        <div style="margin-top:20px; display:flex; justify-content:space-between; align-items:center;">
            <span>ì´ <b id="q-count">0</b>ë¬¸ì œ</span>
            <button style="background:none; border:none; color:#ef4444; cursor:pointer;" onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
        </div>
        <ul id="question-list"></ul>

        <button class="btn" onclick="generateLink()">ğŸ”— ë§í¬ ìƒì„± & ê³µìœ </button>
        
        <div id="share-section" class="hidden" style="margin-top:15px; background:#f1f5f9; padding:15px; border-radius:8px;">
            <p style="margin:0 0 5px 0; font-size:0.9rem;">ğŸ‘‡ ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            <div id="generated-link" style="word-break:break-all; font-size:0.8rem; margin-bottom:10px; color:#4f46e5;"></div>
            <button class="btn btn-outline" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
            <button class="btn" onclick="startQuizInit()">ğŸ”¥ ì•”ê¸° ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div id="quiz-view" class="hidden">
        <div class="quiz-status">
            <span>ë‚¨ì€ ë¬¸ì œ: <b id="remain-count">0</b></span>
            <span class="badge" id="round-badge">1ë¼ìš´ë“œ</span>
        </div>

        <div class="question-box" id="question-display"></div>

        <input type="text" id="quiz-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" onkeypress="handleEnter(event, 'submit')">
        
        <button class="btn" id="btn-submit" onclick="submitAnswer()">ì œì¶œ</button>
        <button class="btn hidden" id="btn-next" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â¡ï¸</button>

        <div id="feedback" class="feedback-area hidden">
            <div id="feedback-msg"></div>
            <div id="correct-answer-show" class="correct-answer-display"></div>
        </div>
    </div>

    <div id="finish-view" class="hidden" style="text-align:center;">
        <h1 style="font-size:3rem; margin-bottom:0;">ğŸ‰</h1>
        <h2>ì™„ë²½í•˜ê²Œ ì•”ê¸°í–ˆìŠµë‹ˆë‹¤!</h2>
        <p>í‹€ë¦° ë¬¸ì œ ì—†ì´ ëª¨ë“  ê³¼ì •ì„ í†µê³¼í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
        <button class="btn" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<script>
    // ë°ì´í„° ì €ì¥ì†Œ
    let allQuestions = []; 
    let quizQueue = [];    
    let retryQueue = [];   
    let currentQ = null;   
    let round = 1;

    // --- 1. ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ ---
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const dataParam = urlParams.get('data');
        if (dataParam) {
            try {
                const decoded = decodeURIComponent(atob(dataParam).split('').map(c => 
                    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                allQuestions = JSON.parse(decoded);
                if(allQuestions.length > 0) startQuizInit();
            } catch (e) { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); }
        }
        updateListUI();
    };

    function handleEnter(e, type) {
        if(e.key === 'Enter') {
            if(type === 'add') addQuestion();
            if(type === 'submit') submitAnswer();
        }
    }

    // --- 2. í¸ì§‘ ê¸°ëŠ¥ (ì¶”ê°€/ì‚­ì œ) ---
    function addQuestion() {
        const q = document.getElementById('input-q').value.trim();
        const a = document.getElementById('input-a').value.trim();
        if(!q || !a) return alert("ë¬¸ì œì™€ ì •ë‹µì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        
        allQuestions.push({ q, a });
        document.getElementById('input-q').value = '';
        document.getElementById('input-a').value = '';
        document.getElementById('input-q').focus();
        updateListUI();
    }

    function loadFromPaste() {
        const text = document.getElementById('bulk-data').value.trim();
        if(!text) return;
        const lines = text.split('\n');
        let count = 0;
        lines.forEach(line => {
            let parts = line.split('\t');
            if(parts.length < 2) parts = line.split(',');
            if(parts.length >= 2) {
                allQuestions.push({ q: parts[0].trim(), a: parts[1].trim() });
                count++;
            }
        });
        alert(`${count}ê°œ ì¶”ê°€ë¨`);
        document.getElementById('bulk-data').value = '';
        updateListUI();
    }

    function updateListUI() {
        const list = document.getElementById('question-list');
        list.innerHTML = '';
        document.getElementById('q-count').innerText = allQuestions.length;
        allQuestions.forEach((item, idx) => {
            list.innerHTML += `<li><span>${item.q}</span> <span style="color:#ef4444;cursor:pointer;" onclick="removeQ(${idx})">ì‚­ì œ</span></li>`;
        });
    }
    
    function removeQ(idx) { allQuestions.splice(idx, 1); updateListUI(); }
    function clearAll() { allQuestions = []; updateListUI(); }

    // --- 3. ë§í¬ ìƒì„± ---
    function generateLink() {
        if(allQuestions.length === 0) return alert("ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.");
        const json = JSON.stringify(allQuestions);
        const encoded = btoa(encodeURIComponent(json).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));
        const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
        document.getElementById('generated-link').innerText = url;
        document.getElementById('share-section').classList.remove('hidden');
    }
    function copyLink() {
        navigator.clipboard.writeText(document.getElementById('generated-link').innerText);
        alert("ë³µì‚¬ì™„ë£Œ!");
    }

    // --- 4. í€´ì¦ˆ ë¡œì§ (í•µì‹¬) ---
    function startQuizInit() {
        if(allQuestions.length === 0) return alert("ë°ì´í„° ì—†ìŒ");
        
        quizQueue = [...allQuestions]; 
        retryQueue = [];
        round = 1;

        document.getElementById('editor-view').classList.add('hidden');
        document.getElementById('quiz-view').classList.remove('hidden');
        
        loadNextQuestion();
    }

    function loadNextQuestion() {
        // íê°€ ë¹„ì—ˆìœ¼ë©´ ë¼ìš´ë“œ ì²´í¬
        if(quizQueue.length === 0) {
            if(retryQueue.length === 0) {
                // ì™„ì „ ì¢…ë£Œ
                document.getElementById('quiz-view').classList.add('hidden');
                document.getElementById('finish-view').classList.remove('hidden');
                return;
            } else {
                // ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘ (í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ)
                quizQueue = [...retryQueue];
                retryQueue = [];
                round++;
                alert(`ğŸ”„ ${round}ë¼ìš´ë“œ ì‹œì‘! í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ í’‰ë‹ˆë‹¤.`);
            }
        }

        // ë¬¸ì œ ë¡œë“œ
        currentQ = quizQueue.shift(); 
        
        // UI ì—…ë°ì´íŠ¸
        document.getElementById('round-badge').innerText = round + "ë¼ìš´ë“œ";
        document.getElementById('remain-count').innerText = quizQueue.length + 1;
        document.getElementById('question-display').innerText = currentQ.q;
        
        // ì…ë ¥ì°½ ì´ˆê¸°í™”
        const input = document.getElementById('quiz-input');
        input.value = '';
        input.disabled = false;
        input.focus();
        
        // ë²„íŠ¼ ë° í”¼ë“œë°± ìƒíƒœ ì´ˆê¸°í™”
        document.getElementById('btn-submit').classList.remove('hidden');
        document.getElementById('btn-next').classList.add('hidden');
        document.getElementById('feedback').classList.add('hidden'); // hidden í´ë˜ìŠ¤ë¥¼ ë‹¤ì‹œ ì ìš©
        document.getElementById('feedback').className = 'feedback-area hidden'; // í´ë˜ìŠ¤ ì´ˆê¸°í™”
    }

    function submitAnswer() {
        const input = document.getElementById('quiz-input');
        const userAns = input.value.trim();
        const correctAns = currentQ.a.trim();
        
        if(!userAns) return; 

        input.disabled = true;

        const feedback = document.getElementById('feedback');
        const feedbackMsg = document.getElementById('feedback-msg');
        const correctShow = document.getElementById('correct-answer-show');
        
        // í”¼ë“œë°± ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” (wrong/correct í´ë˜ìŠ¤ ì œê±°)
        feedback.classList.remove('wrong', 'correct'); 

        // ì •ë‹µ ë¹„êµ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
        if(userAns.toLowerCase() === correctAns.toLowerCase()) {
            // ì •ë‹µ
            feedback.classList.add('correct');
            feedbackMsg.innerText = "ğŸ™†â€â™‚ï¸ ì •ë‹µì…ë‹ˆë‹¤!";
            correctShow.innerText = ""; 
        } else {
            // ì˜¤ë‹µ
            feedback.classList.add('wrong');
            feedbackMsg.innerText = "ğŸ™…â€â™‚ï¸ í‹€ë ¸ìŠµë‹ˆë‹¤.";
            correctShow.innerText = `ì •ë‹µ: ${currentQ.a}`;
            
            // í‹€ë¦° ë¬¸ì œëŠ” ì¬ì‹œë„ íì— ì¶”ê°€
            retryQueue.push(currentQ);
        }
        
        // UI ì—…ë°ì´íŠ¸ (ë²„íŠ¼ ì „í™˜ ë° í”¼ë“œë°± ë°•ìŠ¤ ë³´ì´ê²Œ í•˜ê¸°)
        document.getElementById('btn-submit').classList.add('hidden');
        document.getElementById('btn-next').classList.remove('hidden');
        document.getElementById('btn-next').focus();
        feedback.classList.remove('hidden'); // í”¼ë“œë°± ë°•ìŠ¤ë¥¼ ë³´ì´ê²Œ í•¨
    }

    function nextQuestion() {
        loadNextQuestion();
    }
</script>

</body>
</html>
